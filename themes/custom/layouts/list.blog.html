{{ define "styles" }}
<!--  -->
{{ with resources.Get "styles/blog.css" | resources.Fingerprint }}
<link rel="stylesheet" href="{{ .RelPermalink }}" integrity="{{ .Data.Integrity }}" />
{{ end }}
<!--  -->
{{ end }}{{ define "main" }}

<h1 class="blog-title">Blog</h1>

<!-- Dropdown listagem de categorias -->
<div class="filter-container">
  <label for="categoryDropdown">Filtrar por categoria:</label>

  <!-- Wrapper para permitir a seta -->
  <div class="dropdown-wrapper">
    <select id="categoryDropdown">
      <option value="all">Categorias</option>
      {{ range $name, $taxonomy := .Site.Taxonomies.categories }}
      <option value="{{ $name | urlize }}">{{ $name }}</option>
      {{ end }}
    </select>

    <!-- Ícone da seta -->
    <span class="dropdown-icon">arrow_drop_down</span>
  </div>
</div>

<div class="blog-container">
  <!-- Coluna de posts -->
  <div class="blog-posts">
    {{ $i := 0 }}
    <!-- contador para anúncios -->
    {{ range .Pages }}
    <article class="blog-card" data-category="{{ index .Params.categories 0 | urlize }}">
      <!-- Imagem com overlay -->
      <div class="blog-card-image-wrapper">
        <a href="{{ .RelPermalink }}">
          {{ with .Params.featuredImage }}
          <img class="blog-card-image" src="{{ . }}" alt="{{ $.Title }}" />
          {{ end }}

          <div class="blog-card-overlay">
            <p>Categoria: {{ index .Params.categories 0 }}</p>
            <p>Data de publicação: {{ .Date.Format "02/01/2006" }}</p>
            {{ with .Lastmod }}
            <p>Última atualização: {{ .Format "02/01/2006" }}</p>
            {{ end }}
          </div>
        </a>
      </div>

      <!-- Título e descrição fora da imagem -->
      <div class="blog-card-text">
        <h2>{{ .Title }}</h2>
        <p>{{ .Description }}</p>
      </div>
    </article>

    {{ $i = add $i 1 }}

    <!-- Inserir anúncio a cada 4 posts -->
    {{ if eq (mod $i 4) 0 }}
    <div class="blog-ad">
      <ins
        class="adsbygoogle"
        style="display: block; max-width: 970px; width: 100%; height: 90px"
        data-ad-client="ca-pub-XXXXXX"
        data-ad-slot="YYYYYY"
      ></ins>
      <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>
    {{ end }}

    <!--  -->

    {{ end }}

    <!-- Mensagem caso não haja posts -->
    {{ if not (len .Pages) }}
    <p>Nenhum post encontrado.</p>
    {{ end }}
  </div>

  <!-- Sidebar -->
  {{ partial "sidebar.html" . }}
</div>

<!-- Paginação -->
<div class="blog-pagination">{{ template "_internal/pagination.html" . }}</div>

<!-- Script do menu dropdown da listagem de categorias -->

<script>
  // Seleciona o dropdown e os posts
  const dropdown = document.getElementById("categoryDropdown");
  const posts = document.querySelectorAll(".blog-card");

  // Quando o usuário muda a categoria
  dropdown.addEventListener("change", () => {
    const selectedCategory = dropdown.value;

    posts.forEach((post) => {
      const postCategory = post.dataset.category;

      if (selectedCategory === "all" || postCategory === selectedCategory) {
        post.style.display = "block"; // mostra o post
      } else {
        post.style.display = "none"; // esconde o post
      }
    });
  });
</script>

{{ end }}
